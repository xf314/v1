function w(r=""){return new URL(r,import.meta.url).href}function E(r=""){return w("../")+r}const L=!1;console.log("x isDev:",L);function y(r=4){return new Promise(s=>{setTimeout(()=>{s()},r)})}await __OSL.all(["cesium","vue"]);const{openBlock:x,createElementBlock:T}=__OSL.get("vue"),e=__OSL.get("cesium").default,{onMounted:k,reactive:B,onUnmounted:I,ref:U,computed:A}=__OSL.get("vue"),O={__name:"3d",setup(r){window.CESIUM_BASE_URL="/v1/osl/cesium";const s=U();async function h(i){let a=`${E("map")}/${i}.json`;const t=await e.GeoJsonDataSource.load(a,{stroke:e.Color.AQUA,fill:e.Color.TRANSPARENT,markerSymbol:"?",strokeWidth:20,clamToGround:!0});t.id=i,o.dataSources.add(t);const c=t.entities.values;for(let u=0;u<c.length;u++){const n=c[u];n._name&&(n.adcode=n._properties._adcode._value,n.level=n._properties.level._value,n.title=n._name,n.polygon.material=d.bg,n.polygon.outline=!0,n.polygon.outlineColor=d.outlineColor,n.polygon.outlineWidth=10)}}let o,l;const g=B({hoverEntity:null});async function _(){o=new e.Viewer(s.value,{infoBox:!1,geocoder:!1,homeButton:!1,animation:!1,fullscreenButton:!1,sceneModePicker:!1,timeline:!1,navigationHelpButton:!1,baseLayerPicker:!1,baseLayer:new e.ImageryLayer(new e.UrlTemplateImageryProvider({url:"//wprd01.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scl=2&style=6",minimumlevel:1,maximumLevel:18}))}),o.cesiumWidget.creditContainer.style.display="none",window.viewer=o}const d={bg:e.Color.fromCssColorString("#ff000001"),selectBg:e.Color.BLUE.withAlpha(.3),outlineColor:e.Color.fromCssColorString("#ff000001"),selectOutlineColor:e.Color.BLUE.withAlpha(.5),chainBg:e.Color.fromCssColorString("#ff000001"),chainOutlineColor:e.Color.RED.withAlpha(.8)};function p(){l&&(l.polygon.outlineColor=d.outlineColor,l=null,g.hoverEntity=null)}const C=i=>{console.log("x setHighlight event",i.endPosition,i);const a=o.scene.pick(i.endPosition);if(!e.defined(a))return;const t=a?.id;t?.adcode&&(console.log("x setHighlight entity.adcode",t.adcode,t._name,t),t.adcode!==1e5&&(g.hoverEntity={title:t.title,level:t.level,adcode:t.adcode,x:i.endPosition.x,y:i.endPosition.y},!(l&&t.adcode==l.adcode)&&(p(),l=t,l.polygon.outlineColor=d.selectOutlineColor,console.log("x setHighlight end!! "))))};async function m(i){return new Promise(a=>{o.camera.flyTo({...i,complete:()=>{a()}})})}async function v(){await _(),await y(1e3);const i=new e.ImageryLayer(new e.UrlTemplateImageryProvider({url:"//wprd01.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scl=1&style=7",minimumlevel:1,maximumLevel:18}));await m({destination:e.Cartesian3.fromDegrees(109.25458688074878,31.370515752094477,14481041),orientation:{heading:6.283185307179586,pitch:-1.5686521559334161,roll:0},duration:5}),o.imageryLayers.add(i),await y(500),h("420000"),await m({destination:e.Cartesian3.fromDegrees(112.84545407112302,30.74523702742991,4539256),duration:5}),await m({destination:e.Cartesian3.fromDegrees(114.30039706139502,30.546675177422273,220640),duration:10}),await m({destination:e.Cartesian3.fromDegrees(114.30039706139502,30.546675177422273,693),duration:20});let a,t,c;o.screenSpaceEventHandler.setInputAction(C,e.ScreenSpaceEventType.MOUSE_MOVE),o.screenSpaceEventHandler.setInputAction(u=>{let n=o.scene.globe.pick(o.camera.getPickRay(u.position),o.scene);if(n){const f=e.Cartographic.fromCartesian(n);t=e.Math.toDegrees(f.longitude),c=e.Math.toDegrees(f.latitude),a=Math.ceil(o.camera.positionCartographic.height)}console.log(`x LEFT_CLICK x-y-h: ${t},${c},${a}`),console.log("x LEFT_CLICK viewer.dataSources ",o.dataSources)},e.ScreenSpaceEventType.LEFT_CLICK)}k(v);function S(){o.screenSpaceEventHandler.removeInputAction(e.ScreenSpaceEventType.MOUSE_MOVE),o.screenSpaceEventHandler.removeInputAction(e.ScreenSpaceEventType.LEFT_CLICK),p()}return I(S),(i,a)=>(x(),T("div",{ref_key:"main",ref:s,class:"cesiumContainer"},null,512))}};export{O as default};
